#lang racket/base

(require rackunit
         "simtest.rkt"
         "../src/simulator.rkt"
         "../src/switches.rkt")

(test-case "*** MUX ***"
  (check-table?
    (simulate mux '(1 1 1) '(1) 5)
    '(((0 0 0) (0))
      ((0 1 0) (0))
      ((1 0 0) (1))
      ((1 1 0) (1))
      ((0 0 1) (0))
      ((0 1 1) (1))
      ((1 0 1) (0))
      ((1 1 1) (1)))))

(test-case "*** MUX-4 ***"
  (check-table?
    (simulate mux-4 '(4 4 1) '(4) 5)
    '(((#b0000 #b0000 0) (#b0000))
      ((#b0000 #b0000 1) (#b0000))
      ((#b0000 #b0011 0) (#b0000))
      ((#b0000 #b0011 1) (#b0011))
      ((#b1001 #b0000 0) (#b1001))
      ((#b1001 #b0000 1) (#b0000))
      ((#b1010 #b0101 0) (#b1010))
      ((#b1010 #b0101 1) (#b0101)))))

(test-case "*** MUX-16 ***"
  (check-table?
    (simulate mux-16 '(16 16 1) '(16) 5)
    '(((#b0000000000000000 #b0000000000000000 0) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 1) (#b0000000000000000))
      ((#b0000000000000000 #b0001001000110100 0) (#b0000000000000000))
      ((#b0000000000000000 #b0001001000110100 1) (#b0001001000110100))
      ((#b1001100001110110 #b0000000000000000 0) (#b1001100001110110))
      ((#b1001100001110110 #b0000000000000000 1) (#b0000000000000000))
      ((#b1010101010101010 #b0101010101010101 0) (#b1010101010101010))
      ((#b1010101010101010 #b0101010101010101 1) (#b0101010101010101)))))

(test-case "*** MUX4-16 ***"
  (check-table?
    (simulate mux4-16 '(16 16 16 16 2) '(16) 10)
    '(((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b00) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b01) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b10) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b11) (#b0000000000000000))
      ((#b0001001000110100 #b1001100001110110 #b1010101010101010 #b0101010101010101 #b00) (#b0001001000110100))
      ((#b0001001000110100 #b1001100001110110 #b1010101010101010 #b0101010101010101 #b01) (#b1001100001110110))
      ((#b0001001000110100 #b1001100001110110 #b1010101010101010 #b0101010101010101 #b10) (#b1010101010101010))
      ((#b0001001000110100 #b1001100001110110 #b1010101010101010 #b0101010101010101 #b11) (#b0101010101010101)))))

(test-case "*** MUX8-16 ***"
  (check-table?
    (simulate mux8-16 '(16 16 16 16 16 16 16 16 3) '(16) 15)
    '(((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b000) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b001) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b010) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b011) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b100) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b101) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b110) (#b0000000000000000))
      ((#b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b0000000000000000 #b111) (#b0000000000000000))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b000) (#b0001001000110100))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b001) (#b0010001101000101))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b010) (#b0011010001010110))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b011) (#b0100010101100111))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b100) (#b0101011001111000))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b101) (#b0110011110001001))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b110) (#b0111100010011010))
      ((#b0001001000110100 #b0010001101000101 #b0011010001010110 #b0100010101100111 #b0101011001111000 #b0110011110001001 #b0111100010011010 #b1000100110101011 #b111) (#b1000100110101011)))))

(test-case "*** DMUX ***"
  (check-table?
    (simulate dmux '(1 1) '(1 1) 5)
    '(((0 0) (0 0))
      ((1 0) (1 0))
      ((0 1) (0 0))
      ((1 1) (0 1)))))

(test-case "*** DMUX4 ***"
  (check-table?
    (simulate dmux4 '(1 2) '(1 1 1 1) 10)
    '(((0 #b00) (0 0 0 0))
      ((0 #b01) (0 0 0 0))
      ((0 #b10) (0 0 0 0))
      ((0 #b11) (0 0 0 0))
      ((1 #b00) (1 0 0 0))
      ((1 #b01) (0 1 0 0))
      ((1 #b10) (0 0 1 0))
      ((1 #b11) (0 0 0 1)))))

(test-case "*** DMUX8 ***"
  (check-table?
    (simulate dmux8 '(1 3) '(1 1 1 1 1 1 1 1) 10)
    '(((0 #b000) (0 0 0 0 0 0 0 0))
      ((0 #b001) (0 0 0 0 0 0 0 0))
      ((0 #b010) (0 0 0 0 0 0 0 0))
      ((0 #b011) (0 0 0 0 0 0 0 0))
      ((0 #b100) (0 0 0 0 0 0 0 0))
      ((0 #b101) (0 0 0 0 0 0 0 0))
      ((0 #b110) (0 0 0 0 0 0 0 0))
      ((0 #b111) (0 0 0 0 0 0 0 0))
      ((1 #b000) (1 0 0 0 0 0 0 0))
      ((1 #b001) (0 1 0 0 0 0 0 0))
      ((1 #b010) (0 0 1 0 0 0 0 0))
      ((1 #b011) (0 0 0 1 0 0 0 0))
      ((1 #b100) (0 0 0 0 1 0 0 0))
      ((1 #b101) (0 0 0 0 0 1 0 0))
      ((1 #b110) (0 0 0 0 0 0 1 0))
      ((1 #b111) (0 0 0 0 0 0 0 1)))))
