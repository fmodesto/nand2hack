#lang racket/base

(require rackunit
         "simtest.rkt"
         "../src/simulator.rkt"
         "../src/alu.rkt")

(test-case "*** ALU-PART ***"
  (check-table?
    (simulate alu-part '(1 1 1) '(1) 3)
    '(((0 0 0) (1))
      ((0 0 1) (0))
      ((0 1 0) (1))
      ((0 1 1) (0))
      ((1 0 0) (0))
      ((1 0 1) (0))
      ((1 1 0) (1))
      ((1 1 1) (1)))))

(test-case "*** ALU-FN16 ***"
  (check-table?
    (simulate alu-fn16 '(1 16 16) '(16))
    '(((0 #b0000000000000000 #b0000000000000000) (#b0000000000000000))
      ((0 #b0000000000000000 #b1111111111111111) (#b0000000000000000))
      ((0 #b1111111111111111 #b1111111111111111) (#b1111111111111111))
      ((0 #b1010101010101010 #b0101010101010101) (#b0000000000000000))
      ((0 #b0011110011000011 #b0000111111110000) (#b0000110011000000))
      ((0 #b0001001000110100 #b1001100001110110) (#b0001000000110100))
      ((1 #b0000000000000000 #b0000000000000000) (#b0000000000000000))
      ((1 #b0000000000000000 #b1111111111111111) (#b1111111111111111))
      ((1 #b1111111111111111 #b1111111111111111) (#b1111111111111110))
      ((1 #b1010101010101010 #b0101010101010101) (#b1111111111111111))
      ((1 #b0011110011000011 #b0000111111110000) (#b0100110010110011))
      ((1 #b0001001000110100 #b1001100001110110) (#b1010101010101010)))))

(test-case "*** ALU ***"
  (check-table?
    (simulate alu '(16 16 1 1 1 1 1 1) '(16 1 1))
    '(((#b0000000000000000 #b1111111111111111 1 0 1 0 1 0) (#b0000000000000000 1 0))
      ((#b0000000000000000 #b1111111111111111 1 1 1 1 1 1) (#b0000000000000001 0 0))
      ((#b0000000000000000 #b1111111111111111 1 1 1 0 1 0) (#b1111111111111111 0 1))
      ((#b0000000000000000 #b1111111111111111 0 0 1 1 0 0) (#b0000000000000000 1 0))
      ((#b0000000000000000 #b1111111111111111 1 1 0 0 0 0) (#b1111111111111111 0 1))
      ((#b0000000000000000 #b1111111111111111 0 0 1 1 0 1) (#b1111111111111111 0 1))
      ((#b0000000000000000 #b1111111111111111 1 1 0 0 0 1) (#b0000000000000000 1 0))
      ((#b0000000000000000 #b1111111111111111 0 0 1 1 1 1) (#b0000000000000000 1 0))
      ((#b0000000000000000 #b1111111111111111 1 1 0 0 1 1) (#b0000000000000001 0 0))
      ((#b0000000000000000 #b1111111111111111 0 1 1 1 1 1) (#b0000000000000001 0 0))
      ((#b0000000000000000 #b1111111111111111 1 1 0 1 1 1) (#b0000000000000000 1 0))
      ((#b0000000000000000 #b1111111111111111 0 0 1 1 1 0) (#b1111111111111111 0 1))
      ((#b0000000000000000 #b1111111111111111 1 1 0 0 1 0) (#b1111111111111110 0 1))
      ((#b0000000000000000 #b1111111111111111 0 0 0 0 1 0) (#b1111111111111111 0 1))
      ((#b0000000000000000 #b1111111111111111 0 1 0 0 1 1) (#b0000000000000001 0 0))
      ((#b0000000000000000 #b1111111111111111 0 0 0 1 1 1) (#b1111111111111111 0 1))
      ((#b0000000000000000 #b1111111111111111 0 0 0 0 0 0) (#b0000000000000000 1 0))
      ((#b0000000000000000 #b1111111111111111 0 1 0 1 0 1) (#b1111111111111111 0 1))
      ((#b0101101110100000 #b0001111011010010 1 0 1 0 1 0) (#b0000000000000000 1 0))
      ((#b0101101110100000 #b0001111011010010 1 1 1 1 1 1) (#b0000000000000001 0 0))
      ((#b0101101110100000 #b0001111011010010 1 1 1 0 1 0) (#b1111111111111111 0 1))
      ((#b0101101110100000 #b0001111011010010 0 0 1 1 0 0) (#b0101101110100000 0 0))
      ((#b0101101110100000 #b0001111011010010 1 1 0 0 0 0) (#b0001111011010010 0 0))
      ((#b0101101110100000 #b0001111011010010 0 0 1 1 0 1) (#b1010010001011111 0 1))
      ((#b0101101110100000 #b0001111011010010 1 1 0 0 0 1) (#b1110000100101101 0 1))
      ((#b0101101110100000 #b0001111011010010 0 0 1 1 1 1) (#b1010010001100000 0 1))
      ((#b0101101110100000 #b0001111011010010 1 1 0 0 1 1) (#b1110000100101110 0 1))
      ((#b0101101110100000 #b0001111011010010 0 1 1 1 1 1) (#b0101101110100001 0 0))
      ((#b0101101110100000 #b0001111011010010 1 1 0 1 1 1) (#b0001111011010011 0 0))
      ((#b0101101110100000 #b0001111011010010 0 0 1 1 1 0) (#b0101101110011111 0 0))
      ((#b0101101110100000 #b0001111011010010 1 1 0 0 1 0) (#b0001111011010001 0 0))
      ((#b0101101110100000 #b0001111011010010 0 0 0 0 1 0) (#b0111101001110010 0 0))
      ((#b0101101110100000 #b0001111011010010 0 1 0 0 1 1) (#b0011110011001110 0 0))
      ((#b0101101110100000 #b0001111011010010 0 0 0 1 1 1) (#b1100001100110010 0 1))
      ((#b0101101110100000 #b0001111011010010 0 0 0 0 0 0) (#b0001101010000000 0 0))
      ((#b0101101110100000 #b0001111011010010 0 1 0 1 0 1) (#b0101111111110010 0 0)))))
